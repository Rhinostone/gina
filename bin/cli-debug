#!/usr/bin/env node
'use strict';

const fs    = require('fs');
const {exec} = require('child_process');
const os    = require('os');

var isWin32 = function() {
    return (os.platform() == 'win32') ? true : false;
}

var argv = process.argv.splice(2);
argv = argv.join(' ');

console.log('running: gina ' + argv );

// fetching config
var homeDir = (process.env[(isWin32()) ? 'USERPROFILE' : 'HOME'] );
homeDir += (isWin32()) ? '\\.gina' :  '/.gina';
var mainConf = require(homeDir + ((isWin32()) ? '\\main.json' : '/main.json'));

var version = mainConf.def_framework.split(/\./g);
version = version.splice(0, 2).join('.');

var settings = require(homeDir + ((isWin32()) ? '\\' + version + '\\settings.json' : '/' + version +'/settings.json'));

var debugPort = null;
var params = argv.split(/\s+/g);
if ( params.length > 0 ) {
    for (var p = 0, len = params.length; p < len; ++p) {
        if ( /^\-\-(inspect|debug)/.test(params[p]) ) {
            debugPort = params[p];
            process.argv.splice(p,1);   
        }
    }
}

// gina defaullt debug port
debugPort = (debugPort != null) ? debugPort : '--inspect-brk=' + settings.debug_port;
exec('node ' + debugPort +' '+ __dirname +'/cli ' + argv, (error, stdout, stderr) => {
    if (error) {
        console.error(`exec error: ${error}`);
        return;
    }
    console.log(`${stdout}`);
    //console.error(`${stderr}`);
});